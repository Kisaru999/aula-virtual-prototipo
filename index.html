<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aula Virtual - Prototipo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Estilos personalizados para un diseño más atractivo */
        body {
            font-family: "Inter", sans-serif;
            background-image: url('https://placehold.co/1920x1080/E0E7FF/3F51B5?text=Aprende+y+Crece'); /* Fondo educativo sutil */
            background-size: cover;
            background-attachment: fixed;
            background-position: center;
            position: relative; /* Necesario para el overlay */
        }

        /* Overlay semitransparente sobre la imagen de fondo */
        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(248, 250, 252, 0.8); /* Blanco muy claro con opacidad */
            z-index: -1; /* Asegura que el overlay esté detrás del contenido */
        }

        /* Estilo para ocultar las secciones inicialmente */
        #attendance-details, #daily-details, #grades-details, #notifications-details, #daily-notifications-details, #news-details, #material-details, #subject-units, #unit-material, #summary-modal, #forum-details, #annotations-details {
            display: none;
        }

        /* Estilo básico para la tabla */
        .grades-table th, .grades-table td {
            padding: 15px; /* Más padding */
            border-bottom: 1px solid #e5e7eb; /* Color de borde más suave */
            text-align: left;
            font-size: 1rem; /* Tamaño de fuente ligeramente más grande */
            color: #374151; /* Texto más oscuro */
        }
        .grades-table th {
            background-color: #f3f4f6; /* Fondo de encabezado más claro */
            font-weight: 700; /* Más negrita */
            color: #1f2937; /* Color de texto para encabezados */
        }
         .grades-table {
            width: 100%;
            border-collapse: separate; /* Permite bordes redondeados en las celdas */
            border-spacing: 0; /* Elimina espacio entre celdas */
            border-radius: 12px; /* Bordes redondeados para la tabla */
            overflow: hidden; /* Asegura que los bordes redondeados se apliquen correctamente */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08); /* Sombra para la tabla */
        }

        /* Estilo para cada notificación individual */
        .notification-item {
            background-color: #e0f2fe; /* Azul muy suave (light blue-100) */
            padding: 18px; /* Aumentado el padding */
            border-radius: 15px; /* Bordes más redondeados */
            margin-bottom: 15px; /* Más espacio entre notificaciones */
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.06); /* Sombra más pronunciada */
            transition: transform 0.3s ease, background-color 0.3s ease;
            color: #1e3a8a; /* Azul oscuro para el texto */
            font-weight: 500;
        }
        .notification-item:hover {
            transform: translateY(-5px); /* Efecto hover más notable */
            background-color: #dbeafe; /* Azul un poco más fuerte (light blue-200) */
        }

         .daily-notifications-day {
            margin-bottom: 25px; /* Más espacio */
            padding: 20px; /* Más padding */
            background-color: #ffffff; /* Fondo blanco */
            border-radius: 15px; /* Bordes más redondeados */
            border: 1px solid #e5e7eb; /* Borde más suave */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05); /* Sombra sutil */
        }
         .daily-notifications-day h4 {
            font-weight: 700; /* Más negrita */
            margin-bottom: 12px;
            color: #312e81; /* Índigo oscuro */
            font-size: 1.25rem;
        }
         .daily-notifications-day ul {
            list-style: none; /* Quitamos los bullets por defecto */
            padding-left: 0;
        }
         .daily-notifications-day li {
            margin-bottom: 8px;
            font-size: 1rem;
            color: #4b5563;
            padding-left: 25px; /* Espacio para icono o custom bullet */
            position: relative;
        }
        .daily-notifications-day li::before {
            content: '✓'; /* Custom checkmark bullet */
            color: #10b981; /* Verde esmeralda */
            position: absolute;
            left: 0;
            top: 0;
            font-weight: bold;
            font-size: 1.2em;
        }

         .news-item {
            margin-bottom: 30px; /* Más espacio */
            padding: 25px; /* Más padding */
            background-color: #ffffff; /* Fondo blanco */
            border-radius: 15px; /* Bordes más redondeados */
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08); /* Sombra más prominente */
            border: 1px solid #e5e7eb; /* Borde más suave */
            transition: transform 0.3s ease;
        }
        .news-item:hover {
            transform: translateY(-7px); /* Efecto hover más pronunciado */
        }
          .news-item h3 {
            font-size: 1.6rem; /* Más grande */
            font-weight: 800; /* Extra negrita */
            margin-bottom: 15px;
            color: #312e81; /* Índigo oscuro */
            border-bottom: 2px solid #e0e7ff; /* Subrayado sutil */
            padding-bottom: 8px;
        }
          .news-item p {
            margin-bottom: 12px;
            color: #4b5563;
            line-height: 1.7;
            font-size: 1.05rem;
        }
          .news-item ul {
            list-style: disc;
            padding-left: 30px; /* Más espacio */
            color: #4b5563;
        }
          .news-item li {
            margin-bottom: 8px;
            font-size: 1rem;
        }

          /* Estilo para elementos clicables en Material de Apoyo */
          .material-link {
            display: block;
            padding: 18px; /* Más padding */
            background-color: #e0f2fe; /* Azul muy suave (light blue-100) */
            border-radius: 15px; /* Bordes más redondeados */
            margin-bottom: 15px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.04); /* Sombra sutil */
            color: #1e3a8a; /* Color de texto azul oscuro */
            font-weight: 600; /* Más negrita */
          }
          .material-link:hover {
            background-color: #dbeafe; /* Azul un poco más fuerte (light blue-200) */
            transform: translateY(-3px); /* Efecto hover */
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.08); /* Sombra más pronunciada */
          }

        /* Estilos para el modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background-color: #ffffff;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 700px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            position: relative;
            animation: fadeInScale 0.3s ease-out;
        }

        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .modal-close-button {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            color: #6b7280;
            transition: color 0.2s ease;
        }
        .modal-close-button:hover {
            color: #1f2937;
        }

        /* Estilos para el spinner de carga */
        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Estilos específicos para el Foro */
        #messages-display {
            background-color: #f8fafc; /* light gray */
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            padding: 20px;
            min-height: 300px;
            max-height: 500px;
            overflow-y: auto;
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .message-bubble {
            background-color: #dbeafe; /* light blue */
            padding: 12px 18px;
            border-radius: 18px;
            max-width: 80%;
            align-self: flex-start;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            font-size: 0.95rem;
            color: #1e3a8a;
        }

        .message-bubble.sent {
            background-color: #a7f3d0; /* light green */
            align-self: flex-end;
            color: #065f46;
        }

        .message-bubble .sender {
            font-weight: bold;
            margin-bottom: 5px;
            display: block;
        }

        .message-input-area {
            display: flex;
            gap: 10px;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <header class="bg-indigo-900 text-white p-5 shadow-xl">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-4xl font-extrabold tracking-tight">Aula Virtual</h1>
            <nav>
                <ul class="flex space-x-8">
                    <li><a href="#" class="hover:underline text-xl font-medium transition duration-300">Inicio</a></li>
                    </ul>
            </nav>
        </div>
    </header>

    <main class="container mx-auto mt-12 p-6 flex flex-col lg:flex-row gap-10 flex-grow">

        <section id="main-content" class="flex-grow bg-white bg-opacity-95 p-10 rounded-3xl shadow-2xl shadow-indigo-300/50">
            <h2 class="text-4xl font-bold mb-8 text-indigo-900 border-b-2 border-indigo-200 pb-4">Inicio</h2>
            <div id="main-buttons" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 xl:grid-cols-3 gap-10">

                <div id="btn-asistencia" class="group flex flex-col items-center justify-center p-10 bg-indigo-100 bg-opacity-80 rounded-3xl shadow-lg hover:bg-indigo-200 hover:bg-opacity-90 cursor-pointer transition duration-500 ease-in-out transform hover:scale-105 border border-indigo-200 backdrop-blur-sm">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-20 w-20 text-indigo-700 group-hover:text-indigo-900 mb-4 transition duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                    </svg>
                    <span class="text-2xl font-semibold text-indigo-800 group-hover:text-indigo-900">Asistencia</span>
                </div>

                <div id="btn-calificaciones" class="group flex flex-col items-center justify-center p-10 bg-emerald-100 bg-opacity-80 rounded-3xl shadow-lg hover:bg-emerald-200 hover:bg-opacity-90 cursor-pointer transition duration-500 ease-in-out transform hover:scale-105 border border-emerald-200 backdrop-blur-sm">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-20 w-20 text-emerald-700 group-hover:text-emerald-900 mb-4 transition duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    <span class="text-2xl font-semibold text-emerald-800 group-hover:text-emerald-900">Calificaciones</span>
                </div>

                <div id="btn-notificaciones" class="group flex flex-col items-center justify-center p-10 bg-amber-100 bg-opacity-80 rounded-3xl shadow-lg hover:bg-amber-200 hover:bg-opacity-90 cursor-pointer transition duration-500 ease-in-out transform hover:scale-105 border border-amber-200 backdrop-blur-sm">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-20 w-20 text-amber-700 group-hover:text-amber-900 mb-4 transition duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.405L4 17h5m6 0a6 6 0 00-6 0m6 0h-6" />
                    </svg>
                    <span class="text-2xl font-semibold text-amber-800 group-hover:text-amber-900">Notificaciones</span>
                </div>

                    <div id="btn-noticias" class="group flex flex-col items-center justify-center p-10 bg-fuchsia-100 bg-opacity-80 rounded-3xl shadow-lg hover:bg-fuchsia-200 hover:bg-opacity-90 cursor-pointer transition duration-500 ease-in-out transform hover:scale-105 border border-fuchsia-200 backdrop-blur-sm">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-20 w-20 text-fuchsia-700 group-hover:text-fuchsia-900 mb-4 transition duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.523 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5S19.832 5.477 21 6.253v13C19.832 18.523 18.246 18 16.5 18s-3.332.477-4.5 1.253" />
                        </svg>
                        <span class="text-2xl font-semibold text-fuchsia-800 group-hover:text-fuchsia-900">Noticias</span>
                    </div>

                <div id="btn-material" class="group flex flex-col items-center justify-center p-10 bg-rose-100 bg-opacity-80 rounded-3xl shadow-lg hover:bg-rose-200 hover:bg-opacity-90 cursor-pointer transition duration-500 ease-in-out transform hover:scale-105 border border-rose-200 backdrop-blur-sm">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-20 w-20 text-rose-700 group-hover:text-rose-900 mb-4 transition duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h.5c.5 0 1 .5 1 1s.5 1 1 1h2.5M7 7h14m-9 4h.01M7 15h.01" />
                    </svg>
                    <span class="text-2xl font-semibold text-rose-800 group-hover:text-rose-900">Material de apoyo</span>
                </div>

                <div id="btn-foro" class="group flex flex-col items-center justify-center p-10 bg-sky-100 bg-opacity-80 rounded-3xl shadow-lg hover:bg-sky-200 hover:bg-opacity-90 cursor-pointer transition duration-500 ease-in-out transform hover:scale-105 border border-sky-200 backdrop-blur-sm">
                    <svg xmlns="http://www.w3.org/2000/svg" width="256" height="256" fill="currentColor" class="h-20 w-20 text-sky-700 group-hover:text-sky-900 mb-4 transition duration-300" viewBox="0 0 256 256"><path d="M168,144H88a8,8,0,0,0,0,16h80a8,8,0,0,0,0-16ZM184,112H88a8,8,0,0,0,0,16h96a8,8,0,0,0,0-16ZM232,48V176a16,16,0,0,1-16,16H163.6l-36.5,27.4a8,8,0,0,1-9.8,0L92.4,192H40a16,16,0,0,1-16-16V48A16,16,0,0,1,40,32H216A16,16,0,0,1,232,48Zm-16,0a0,0,0,0,0,0,0V176a0,0,0,0,0,0,0H40a0,0,0,0,0,0,0V48Z"></path></svg>
                    <span class="text-2xl font-semibold text-sky-800 group-hover:text-sky-900">Foro</span>
                </div>

                <div id="btn-anotaciones" class="group flex flex-col items-center justify-center p-10 bg-orange-100 bg-opacity-80 rounded-3xl shadow-lg hover:bg-orange-200 hover:bg-opacity-90 cursor-pointer transition duration-500 ease-in-out transform hover:scale-105 border border-orange-200 backdrop-blur-sm">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-20 w-20 text-orange-700 group-hover:text-orange-900 mb-4 transition duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
                    </svg>
                    <span class="text-2xl font-semibold text-orange-800 group-hover:text-orange-900">Anotaciones</span>
                </div>

            </div>

            <div id="attendance-details" class="mt-12 p-10 bg-white rounded-3xl shadow-xl border border-gray-100">
                <h2 class="text-3xl font-bold mb-8 text-indigo-900">Detalles de Asistencia</h2>

                <div class="mb-8 p-6 bg-blue-50 border border-blue-200 rounded-2xl shadow-md">
                    <p class="text-xl mb-3 text-blue-800"><span class="font-bold">Asistencia mínima requerida:</span> 70%</p>
                    <p class="text-xl text-blue-800"><span class="font-bold">Tu asistencia actual:</span> 82%</p>
                </div>

                <div id="monthly-history" class="mt-10">
                    <h3 class="text-2xl font-semibold mb-6 text-indigo-900">Historial de Asistencia por Mes</h3>
                    <ul class="list-none space-y-4">
                        <li class="flex justify-between items-center p-4 bg-gray-50 rounded-lg shadow-sm border border-gray-200">
                            <span class="text-lg text-gray-800">Enero: 100%</span>
                            <button class="text-blue-600 hover:text-blue-800 text-base font-medium view-detail-btn px-4 py-2 rounded-lg hover:bg-blue-100 transition duration-300" data-month="enero">Ver detallado</button>
                        </li>
                            <li class="flex justify-between items-center p-4 bg-gray-50 rounded-lg shadow-sm border border-gray-200">
                                <span class="text-lg text-gray-800">Febrero: 90%</span>
                                <button class="text-blue-600 hover:text-blue-800 text-base font-medium view-detail-btn px-4 py-2 rounded-lg hover:bg-blue-100 transition duration-300" data-month="febrero">Ver detallado</button>
                            </li>
                            <li class="flex justify-between items-center p-4 bg-gray-50 rounded-lg shadow-sm border border-gray-200">
                                <span class="text-lg text-gray-800">Marzo: 85%</span>
                                <button class="text-blue-600 hover:text-blue-800 text-base font-medium view-detail-btn px-4 py-2 rounded-lg hover:bg-blue-100 transition duration-300" data-month="marzo">Ver detallado</button>
                            </li>
                            <li class="flex justify-between items-center p-4 bg-gray-50 rounded-lg shadow-sm border border-gray-200">
                                <span class="text-lg text-gray-800">Abril: 78%</span>
                                <button class="text-blue-600 hover:text-blue-800 text-base font-medium view-detail-btn px-4 py-2 rounded-lg hover:bg-blue-100 transition duration-300" data-month="abril">Ver detallado</button>
                            </li>
                            <li class="flex justify-between items-center p-4 bg-gray-50 rounded-lg shadow-sm border border-gray-200">
                                <span class="text-lg text-gray-800">Mayo: 82%</span>
                                <button class="text-blue-600 hover:text-blue-800 text-base font-medium view-detail-btn px-4 py-2 rounded-lg hover:bg-blue-100 transition duration-300" data-month="mayo">Ver detallado</button>
                            </li>
                        </ul>
                </div>

                <div id="daily-details" class="mt-10 p-8 bg-blue-50 rounded-2xl shadow-lg border border-blue-200">
                    <h3 class="text-2xl font-semibold mb-6 text-indigo-900">Detalle Diario de Asistencia (<span id="detail-month" class="font-bold"></span>)</h3>
                    <ul id="daily-list" class="list-disc list-inside space-y-3 text-gray-700 text-lg">
                        </ul>
                    <button id="btn-close-daily-details" class="mt-8 bg-gray-100 hover:bg-gray-200 text-gray-800 font-bold py-3 px-6 rounded-md focus:outline-none focus:shadow-outline transition duration-300 ease-in-out text-base shadow-sm hover:shadow-md">
                        Cerrar detalle
                    </button>
                </div>

                <button id="btn-justify-attendance" class="mt-10 bg-blue-700 hover:bg-blue-800 text-white font-bold py-4 px-8 rounded-xl focus:outline-none focus:shadow-outline transition duration-300 ease-in-out w-full shadow-lg hover:shadow-xl text-xl">
                    JUSTIFICAR ASISTENCIA
                </button>

                    <button id="btn-close-attendance" class="mt-6 bg-gray-100 hover:bg-gray-200 text-gray-800 font-bold py-3 px-6 rounded-md focus:outline-none focus:shadow-outline transition duration-300 ease-in-out w-full shadow-sm hover:shadow-md">
                        Cerrar
                    </button>
            </div>

            <div id="grades-details" class="mt-12 p-10 bg-white rounded-3xl shadow-xl border border-gray-100">
                <h2 class="text-3xl font-bold mb-8 text-indigo-900">Calificaciones</h2>

                <div class="overflow-x-auto">
                    <h3 class="text-2xl font-semibold mb-6 text-indigo-900">Notas por Materia</h3>
                    <table class="grades-table border border-gray-200">
                        <thead>
                            <tr>
                                <th>Materia</th>
                                <th>Notas</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Matemáticas</td>
                                <td>6.5, 5.8, 7.0, 6.0</td>
                            </tr>
                            <tr>
                                <td>Lenguaje</td>
                                <td>7.0, 4.5, 6.8, 5.9</td>
                            </tr>
                            <tr>
                                <td>Ed. Física</td>
                                <td>6.0, 6.2, 5.5</td>
                            </tr>
                            <tr>
                                <td>Ciencias Naturales</td>
                                <td>5.0, 6.3, 7.0, 6.8</td>
                            </tr>
                            <tr>
                                <td>Inglés</td>
                                <td>7.0, 7.0, 6.9</td>
                            </tr>
                            <tr>
                                <td>Historia</td>
                                <td>5.5, 6.0, 6.5, 5.8</td>
                            </tr>
                            <tr>
                                <td>Religión</td>
                                <td>7.0, 7.0, 7.0</td>
                            </tr>
                            <tr>
                                <td>Música</td>
                                <td>6.8, 7.0, 6.5</td>
                            </tr>
                            <tr>
                                <td>Artes Visuales</td>
                                <td>7.0, 6.9, 7.0</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                    <button id="btn-close-grades" class="mt-10 bg-gray-100 hover:bg-gray-200 text-gray-800 font-bold py-3 px-6 rounded-md focus:outline-none focus:shadow-outline transition duration-300 ease-in-out w-full shadow-sm hover:shadow-md">
                        Cerrar
                    </button>
            </div>

            <div id="notifications-details" class="mt-12 p-10 bg-white rounded-3xl shadow-xl border border-gray-100">
                <h2 class="text-3xl font-bold mb-8 text-indigo-900">Notificaciones</h2>

                <div id="recent-notifications" class="p-8 bg-blue-50 rounded-2xl shadow-md border border-blue-200">
                    <h3 class="text-2xl font-semibold mb-6 text-indigo-900">Mensajes Recientes</h3>
                    <ul id="notifications-list" class="list-none space-y-4">
                        <li class="notification-item">Se agregó una calificación a: Lenguaje</li>
                        <li class="notification-item">El día de hoy Martin asistió a clases</li>
                        <li class="notification-item" id="reunion-notification">Hoy hay reunión de apoderados <span id="reunion-datetime" class="text-sm text-gray-600 font-normal"></span></li>
                        </ul>
                        <button id="btn-view-all-notifications" class="mt-8 text-blue-700 hover:underline text-lg font-medium px-4 py-2 rounded-lg hover:bg-blue-100 transition duration-300">Ver todos los mensajes enviados por días</button>
                </div>

                    <div id="daily-notifications-details" class="mt-10 p-8 bg-white rounded-2xl shadow-md border border-gray-200">
                        <h3 class="text-2xl font-semibold mb-6 text-indigo-900">Historial de Notificaciones por Día</h3>
                        <div id="daily-notifications-list">
                            </div>
                        <button id="btn-close-daily-notifications" class="mt-8 bg-gray-100 hover:bg-gray-200 text-gray-800 font-bold py-3 px-6 rounded-md focus:outline-none focus:shadow-outline transition duration-300 ease-in-out w-full shadow-sm hover:shadow-md">
                            Cerrar detalle diario
                        </button>
                    </div>


                    <button id="btn-close-notifications" class="mt-10 bg-gray-100 hover:bg-gray-200 text-gray-800 font-bold py-3 px-6 rounded-md focus:outline-none focus:shadow-outline transition duration-300 ease-in-out w-full shadow-sm hover:shadow-md">
                        Cerrar
                    </button>
            </div>

                <div id="news-details" class="mt-12 p-10 bg-white rounded-3xl shadow-xl border border-gray-100">
                    <h2 class="text-3xl font-bold mb-8 text-indigo-900">Noticias</h2>

                    <div class="news-item">
                        <h3>Vacaciones de Invierno</h3>
                        <p>Estimados alumnos y apoderados:</p>
                        <p>Les informamos que las vacaciones de invierno de este año se llevarán a cabo desde el <strong>15 de Julio de 2024</strong> hasta el <strong>26 de Julio de 2024</strong>, ambos días inclusive. Las clases se reanudarán el día Lunes 29 de Julio de 2024.</p>
                    </div>

                        <div class="news-item">
                            <h3>¡Aniversario del Colegio!</h3>
                            <p>Nuestro querido colegio está de aniversario. Este año celebramos <strong>75 años</strong> de historia, educación y comunidad.</p>
                            <p>Para conmemorar esta importante fecha, se realizarán las siguientes actividades:</p>
                            <ul>
                                <li>Ceremonia oficial conmemorativa</li>
                                <li>Feria de proyectos estudiantiles</li>
                                <li>Competencias deportivas inter-alianzas</li>
                                <li>Show de talentos</li>
                                <li>Convivencia familiar y cierre con música en vivo</li>
                            </ul>
                            <p>¡Los esperamos a todos para celebrar juntos!</p>
                        </div>


                        <button id="btn-close-news" class="mt-10 bg-gray-100 hover:bg-gray-200 text-gray-800 font-bold py-3 px-6 rounded-md focus:outline-none focus:shadow-outline transition duration-300 ease-in-out w-full shadow-sm hover:shadow-md">
                            Cerrar
                        </button>
                </div>

                <div id="material-details" class="mt-12 p-10 bg-white rounded-3xl shadow-xl border border-gray-100">
                    <h2 class="text-3xl font-bold mb-8 text-indigo-900">Material de Apoyo</h2>

                    <div id="subject-list" class="p-8 bg-blue-50 rounded-2xl shadow-md border border-blue-200">
                        <h3 class="text-2xl font-semibold mb-6 text-indigo-900">Materias</h3>
                        <ul class="list-none space-y-4">
                            <li class="material-link" data-subject="matematicas">Matemáticas</li>
                            <li class="material-link" data-subject="lenguaje">Lenguaje</li>
                            <li class="material-link" data-subject="ed_fisica">Ed. Física</li>
                            <li class="material-link" data-subject="ciencias_naturales">Ciencias Naturales</li>
                            <li class="material-link" data-subject="ingles">Inglés</li>
                            <li class="material-link" data-subject="historia">Historia</li>
                            <li class="material-link" data-subject="religion">Religión</li>
                            <li class="material-link" data-subject="musica">Música</li>
                            <li class="material-link" data-subject="artes_visuales">Artes Visuales</li>
                        </ul>
                    </div>

                    <div id="subject-units" class="mt-10 p-8 bg-white rounded-2xl shadow-md border border-gray-200">
                        <h3 class="text-2xl font-semibold mb-6 text-indigo-900">Unidades de <span id="current-subject" class="font-bold"></span></h3>
                        <ul id="units-list" class="list-none space-y-4">
                            </ul>
                        <button id="btn-back-to-subjects" class="mt-8 bg-gray-100 hover:bg-gray-200 text-gray-800 font-bold py-3 px-6 rounded-md focus:outline-none focus:shadow-outline transition duration-300 ease-in-out shadow-sm hover:shadow-md">
                            Volver a Materias
                        </button>
                    </div>

                    <div id="unit-material" class="mt-10 p-8 bg-white rounded-2xl shadow-md border border-gray-200">
                            <h3 class="text-2xl font-semibold mb-6 text-indigo-900">Material de <span id="current-unit" class="font-bold"></span></h3>
                            <div id="material-content" class="space-y-4">
                                <!-- Material items will be populated here -->
                            </div>
                            <button id="btn-generate-summary" class="mt-8 bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-md focus:outline-none focus:shadow-outline transition duration-300 ease-in-out w-full shadow-lg hover:shadow-xl text-lg">
                                Generar Resumen de la Unidad ✨
                            </button>
                            <button id="btn-back-to-units" class="mt-6 bg-gray-100 hover:bg-gray-200 text-gray-800 font-bold py-3 px-6 rounded-md focus:outline-none focus:shadow-outline transition duration-300 ease-in-out w-full shadow-sm hover:shadow-md">
                                Volver a Unidades
                            </button>
                    </div>


                        <button id="btn-close-material" class="mt-10 bg-gray-100 hover:bg-gray-200 text-gray-800 font-bold py-3 px-6 rounded-md focus:outline-none focus:shadow-outline transition duration-300 ease-in-out w-full shadow-sm hover:shadow-md">
                            Cerrar
                        </button>
                </div>

                <div id="forum-details" class="mt-12 p-10 bg-white rounded-3xl shadow-xl border border-gray-100">
                    <h2 class="text-3xl font-bold mb-8 text-indigo-900">Foro de Discusión</h2>

                    <div id="messages-display" class="mb-6">
                        <!-- Messages will be appended here -->
                        <div class="message-bubble">
                            <span class="sender">Profesor:</span> ¡Bienvenidos al foro de discusión! Aquí podemos compartir dudas y recursos.
                        </div>
                        <div class="message-bubble sent">
                            <span class="sender">Tú:</span> ¡Gracias, profesor! ¡Qué buena iniciativa!
                        </div>
                    </div>

                    <div class="message-input-area">
                        <textarea id="forum-message-input" class="flex-grow shadow-sm appearance-none border border-gray-300 rounded-lg py-3 px-4 text-gray-800 leading-tight focus:outline-none focus:ring-2 focus:ring-sky-400 focus:border-transparent transition duration-200 text-lg" rows="3" placeholder="Escribe tu mensaje aquí..."></textarea>
                        <button id="btn-send-forum-message" class="bg-sky-600 hover:bg-sky-700 text-white font-bold py-3 px-6 rounded-md focus:outline-none focus:shadow-outline transition duration-300 ease-in-out shadow-lg hover:shadow-xl text-lg self-end">
                            Enviar Mensaje
                        </button>
                    </div>

                    <button id="btn-close-forum" class="mt-10 bg-gray-100 hover:bg-gray-200 text-gray-800 font-bold py-3 px-6 rounded-md focus:outline-none focus:shadow-outline transition duration-300 ease-in-out w-full shadow-sm hover:shadow-md">
                        Cerrar Foro
                    </button>
                </div>

                <div id="annotations-details" class="mt-12 p-10 bg-white rounded-3xl shadow-xl border border-gray-100">
                    <h2 class="text-3xl font-bold mb-8 text-indigo-900">Anotaciones del Alumno</h2>

                    <div class="mb-8 p-8 bg-green-50 rounded-2xl shadow-md border border-green-200">
                        <h3 class="text-2xl font-semibold mb-6 text-indigo-900">Anotaciones Positivas</h3>
                        <ul id="positive-annotations-list" class="list-none space-y-4">
                            <li class="p-4 bg-white rounded-lg shadow-sm border border-gray-200 text-gray-800 text-lg">
                                <span class="font-bold text-green-700">Fecha: 08/06/2024</span> - Excelente participación en la clase de Matemáticas.
                            </li>
                            <li class="p-4 bg-white rounded-lg shadow-sm border border-gray-200 text-gray-800 text-lg">
                                <span class="font-bold text-green-700">Fecha: 05/06/2024</span> - Colaboración destacada en el proyecto grupal de Ciencias.
                            </li>
                            <!-- Future positive annotations will be added here -->
                        </ul>
                    </div>

                    <div class="mb-8 p-8 bg-red-50 rounded-2xl shadow-md border border-red-200">
                        <h3 class="text-2xl font-semibold mb-6 text-indigo-900">Anotaciones Negativas</h3>
                        <ul id="negative-annotations-list" class="list-none space-y-4">
                            <li class="p-4 bg-white rounded-lg shadow-sm border border-gray-200 text-gray-800 text-lg">
                                <span class="font-bold text-red-700">Fecha: 07/06/2024</span> - Retraso recurrente en la entrega de tareas de Lenguaje.
                            </li>
                            <!-- Future negative annotations will be added here -->
                        </ul>
                    </div>

                    <button id="btn-close-annotations" class="mt-10 bg-gray-100 hover:bg-gray-200 text-gray-800 font-bold py-3 px-6 rounded-md focus:outline-none focus:shadow-outline transition duration-300 ease-in-out w-full shadow-sm hover:shadow-md">
                        Cerrar Anotaciones
                    </button>
                </div>


        </section>

        <aside class="w-full lg:w-1/3 bg-white bg-opacity-95 p-10 rounded-3xl shadow-2xl shadow-indigo-300/50">

            <div>
                <h2 class="text-3xl font-bold mb-8 text-indigo-900">Iniciar Sesión</h2>
                <form>
                    <div class="mb-6">
                        <label for="rut" class="block text-gray-700 text-lg font-semibold mb-3">RUT</label>
                        <input type="text" id="rut" class="shadow-sm appearance-none border border-gray-300 rounded-lg w-full py-4 px-5 text-gray-800 leading-tight focus:outline-none focus:ring-3 focus:ring-blue-400 focus:border-transparent transition duration-200 text-lg">
                    </div>
                    <div class="mb-8">
                        <label for="contrasena" class="block text-gray-700 text-lg font-semibold mb-3">Contraseña</label>
                        <input type="password" id="contrasena" class="shadow-sm appearance-none border border-gray-300 rounded-lg w-full py-4 px-5 text-gray-800 mb-5 leading-tight focus:outline-none focus:ring-3 focus:ring-blue-400 focus:border-transparent transition duration-200 text-lg">
                    </div>
                    <div class="flex items-center justify-between">
                        <button id="btn-ingresar" type="button" class="bg-blue-700 hover:bg-blue-800 text-white font-bold py-4 px-8 rounded-xl focus:outline-none focus:shadow-outline transition duration-300 ease-in-out w-full shadow-lg hover:shadow-xl text-xl">
                            Ingresar
                        </button>
                    </div>
                </form>
            </div>

        </aside>

    </main>

    <!-- Summary Modal Structure -->
    <div id="summary-modal" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close-button" id="close-summary-modal">&times;</button>
            <h3 class="text-2xl font-bold mb-6 text-indigo-900">Resumen de la Unidad</h3>
            <div id="summary-loader" class="loader"></div>
            <p id="summary-text" class="text-gray-800 leading-relaxed text-lg hidden">
                <!-- Summary will be inserted here by JavaScript -->
            </p>
            <p id="summary-error" class="text-red-600 text-center hidden">
                Hubo un error al generar el resumen. Por favor, intenta de nuevo más tarde.
            </p>
        </div>
    </div>


    <script>
        const mainButtons = document.getElementById('main-buttons');
        const attendanceDetails = document.getElementById('attendance-details');
        const monthlyHistory = document.getElementById('monthly-history');
        const dailyDetails = document.getElementById('daily-details');
        const detailMonthSpan = document.getElementById('detail-month');
        const dailyList = document.getElementById('daily-list');
        const btnCloseAttendance = document.getElementById('btn-close-attendance');
        const btnCloseDailyDetails = document.getElementById('btn-close-daily-details');
        const btnJustifyAttendance = document.getElementById('btn-justify-attendance');
        const mainContentTitle = document.querySelector('#main-content h2'); // Referencia al título de la sección principal

        const gradesDetails = document.getElementById('grades-details'); // Nueva referencia a la sección de calificaciones
        const btnCloseGrades = document.getElementById('btn-close-grades'); // Nueva referencia al botón de cerrar calificaciones

        const notificationsDetails = document.getElementById('notifications-details'); // Nueva referencia a la sección de notificaciones
        const recentNotifications = document.getElementById('recent-notifications'); // Referencia a la sección de mensajes recientes
        const dailyNotificationsDetails = document.getElementById('daily-notifications-details'); // Nueva referencia a la sección de notificaciones diarias
        const dailyNotificationsList = document.getElementById('daily-notifications-list'); // Referencia a la lista de notificaciones diarias
        const btnCloseNotifications = document.getElementById('btn-close-notifications'); // Nueva referencia al botón de cerrar notificaciones
        const btnViewAllNotifications = document.getElementById('btn-view-all-notifications'); // Nueva referencia al botón "Ver todos"
        const btnCloseDailyNotifications = document.getElementById('btn-close-daily-notifications'); // Nueva referencia al botón cerrar detalle diario de notificaciones
        const reunionDatetimeSpan = document.getElementById('reunion-datetime'); // Nueva referencia al span para la fecha y hora de la reunión

        const newsDetails = document.getElementById('news-details'); // Nueva referencia a la sección de noticias
        const btnCloseNews = document.getElementById('btn-close-news'); // Nueva referencia al botón de cerrar noticias

        const materialDetails = document.getElementById('material-details'); // Nueva referencia a la sección de material de apoyo
        const subjectList = document.getElementById('subject-list'); // Referencia a la lista de materias
        const subjectUnits = document.getElementById('subject-units'); // Referencia a la sección de unidades
        const currentSubjectSpan = document.getElementById('current-subject'); // Referencia al span del nombre de la materia actual
        const unitsList = document.getElementById('units-list'); // Referencia a la lista de unidades
        const unitMaterial = document.getElementById('unit-material'); // Referencia a la sección de material de unidad
        const currentUnitSpan = document.getElementById('current-unit'); // Referencia al span del nombre de la unidad actual
        const materialContent = document.getElementById('material-content'); // Referencia al div del contenido del material
        const btnBackToSubjects = document.getElementById('btn-back-to-subjects'); // Botón para volver a materias
        const btnBackToUnits = document.getElementById('btn-back-to-units'); // Botón para volver a unidades
        const btnCloseMaterial = document.getElementById('btn-close-material'); // Botón para cerrar material de apoyo

        // Gemini API Integration elements
        const btnGenerateSummary = document.getElementById('btn-generate-summary');
        const summaryModal = document.getElementById('summary-modal');
        const closeSummaryModalBtn = document.getElementById('close-summary-modal');
        const summaryLoader = document.getElementById('summary-loader');
        const summaryText = document.getElementById('summary-text');
        const summaryError = document.getElementById('summary-error');

        // Forum elements
        const forumDetails = document.getElementById('forum-details');
        const btnCloseForum = document.getElementById('btn-close-forum');
        const forumMessageInput = document.getElementById('forum-message-input');
        const btnSendForumMessage = document.getElementById('btn-send-forum-message');
        const messagesDisplay = document.getElementById('messages-display');

        // Annotations elements
        const annotationsDetails = document.getElementById('annotations-details');
        const btnCloseAnnotations = document.getElementById('btn-close-annotations');


        // Datos de ejemplo para el detalle diario de asistencia
        const dailyAttendanceData = {
            enero: ["Día 1: Presente", "Día 2: Presente", "Día 3: Presente", "Día 4: Presente", "Día 5: Presente"],
            febrero: ["Día 1: Presente", "Día 2: Ausente", "Día 3: Presente", "Día 4: Presente", "Día 5: Presente"],
            marzo: ["Día 1: Presente", "Día 2: Presente", "Día 3: Ausente", "Día 4: Presente", "Día 5: Presente"],
            abril: ["Día 1: Ausente", "Día 2: Presente", "Día 3: Presente", "Día 4: Presente", "Día 5: Ausente"],
            mayo: ["Día 1: Presente", "Día 2: Presente", "Día 3: Presente", "Día 4: Ausente", "Día 5: Presente"]
        };

          // Datos de ejemplo para notificaciones por día
        const dailyNotificationsData = {
            "2024-10-26": [
                "Se agregó una calificación a: Lenguaje",
                "El día de hoy Martin asistió a clases"
            ],
            "2024-10-25": [
                "Recordatorio: Entrega de proyecto de Matemáticas mañana.",
                "Nuevo material de apoyo disponible para Ciencias Naturales."
            ],
            "2024-10-24": [
                "Hoy hay reunión de apoderados - 18:00",
                "La clase de Ed. Física se realizará en el gimnasio."
            ]
        };

        // Datos de ejemplo para Material de Apoyo (Materias, Unidades y Material)
        const materialData = {
            matematicas: {
                name: "Matemáticas",
                units: {
                    unidad_1: {
                        name: "Unidad 1: Fracciones con igual denominador",
                        material: [
                            "Documento 1: Conceptos básicos de fracciones.pdf",
                            "Video: Suma y resta de fracciones con igual denominador.mp4",
                            "Actividad: Ejercicios de práctica.docx"
                        ]
                    },
                    unidad_2: {
                            name: "Unidad 2: Multiplicación y división de fracciones",
                            material: [
                                "Documento 1: Multiplicación de fracciones.pdf",
                                "Documento 2: División de fracciones.pdf",
                                "Video: Multiplicación y división explicada.mp4"
                            ]
                        }
                }
            },
            lenguaje: {
                name: "Lenguaje",
                units: {
                    unidad_1: {
                        name: "Unidad 1: Comprensión lectora",
                        material: [
                            "Documento: Estrategias de comprensión lectora.pdf",
                            "Actividad: Análisis de textos cortos.docx"
                        ]
                    },
                        unidad_2: {
                            name: "Unidad 2: Gramática y ortografía",
                            material: [
                                "Documento: Reglas básicas de ortografía.pdf",
                                "Video: Uso de los signos de puntuación.mp4"
                            ]
                        }
                }
            },
            ed_fisica: {
                    name: "Ed. Física",
                    units: {
                        unidad_1: {
                            name: "Unidad 1: Calentamiento y estiramiento",
                            material: [
                                "Documento: Rutina de calentamiento.pdf",
                                "Video: Ejercicios de estiramiento.mp4"
                            ]
                        }
                    }
            },
              ciencias_naturales: {
                    name: "Ciencias Naturales",
                    units: {
                        unidad_1: {
                            name: "Unidad 1: El ciclo del agua",
                            material: [
                                "Documento: El ciclo del agua explicado.pdf",
                                "Video: Animación del ciclo del agua.mp4",
                                "Grabación de clase del 05 de mayo de 2024"
                            ]
                        }
                    }
            },
              ingles: {
                    name: "Inglés",
                    units: {
                        unidad_1: {
                            name: "Unidad 1: Saludos y presentaciones",
                            material: [
                                "Documento: Frases comunes.pdf",
                                "Audio: Pronunciación.mp3"
                            ]
                        }
                    }
            },
              historia: {
                    name: "Historia",
                    units: {
                        unidad_1: {
                            name: "Unidad 1: Civilizaciones antiguas",
                            material: [
                                "Documento: Resumen de civilizaciones.pdf",
                                "Presentación: Egipto y Mesopotamia.pptx"
                            ]
                        }
                    }
            },
              religion: {
                    name: "Religión",
                    units: {
                        unidad_1: {
                            name: "Unidad 1: Valores universales",
                            material: [
                                "Documento: Los valores y su importancia.pdf"
                            ]
                        }
                    }
            },
              musica: {
                    name: "Música",
                    units: {
                        unidad_1: {
                            name: "Unidad 1: Notas musicales",
                            material: [
                                "Documento: Introducción a las notas.pdf",
                                "Audio: Sonido de las notas.mp3"
                            ]
                        }
                    }
            },
              artes_visuales: {
                    name: "Artes Visuales",
                    units: {
                        unidad_1: {
                            name: "Unidad 1: Teoría del color",
                            material: [
                                "Documento: El círculo cromático.pdf",
                                "Video: Mezcla de colores.mp4"
                            ]
                        }
                    }
            }
        };

        // Función para mostrar una sección y ocultar las demás
        function showSection(sectionToShow) {
            // Oculta todos los botones principales si no estamos volviendo a ellos
            if (sectionToShow !== mainButtons) {
                mainButtons.style.display = 'none';
            } else {
                mainButtons.style.display = 'grid'; // Mostrar como grid si volvemos a los botones principales
            }

            // Oculta todas las secciones de detalles
            attendanceDetails.style.display = 'none';
            gradesDetails.style.display = 'none';
            notificationsDetails.style.display = 'none';
            dailyNotificationsDetails.style.display = 'none'; // Asegurarse de que esta también se oculte
            newsDetails.style.display = 'none';
            materialDetails.style.display = 'none';
            subjectUnits.style.display = 'none';
            unitMaterial.style.display = 'none';
            summaryModal.style.display = 'none'; // Ensure modal is hidden when changing sections
            forumDetails.style.display = 'none'; // Ensure forum details are hidden
            annotationsDetails.style.display = 'none'; // Ensure annotations details are hidden


            // Muestra la sección deseada
            sectionToShow.style.display = 'block';

            // Actualiza el título de la sección principal
            if (sectionToShow === attendanceDetails) {
                mainContentTitle.textContent = 'Asistencia';
            } else if (sectionToShow === gradesDetails) {
                mainContentTitle.textContent = 'Calificaciones';
            } else if (sectionToShow === notificationsDetails) {
                mainContentTitle.textContent = 'Notificaciones';
            } else if (sectionToShow === newsDetails) {
                mainContentTitle.textContent = 'Noticias';
            } else if (sectionToShow === materialDetails) {
                mainContentTitle.textContent = 'Material de Apoyo';
            } else if (sectionToShow === forumDetails) {
                mainContentTitle.textContent = 'Foro de Discusión';
            } else if (sectionToShow === annotationsDetails) { // New condition for Annotations
                mainContentTitle.textContent = 'Anotaciones del Alumno';
            }
            else if (sectionToShow === mainButtons) {
                mainContentTitle.textContent = 'Inicio';
            }
        }

        // Event Listeners para los botones principales
        document.getElementById('btn-asistencia').addEventListener('click', () => showSection(attendanceDetails));
        document.getElementById('btn-calificaciones').addEventListener('click', () => showSection(gradesDetails));
        document.getElementById('btn-notificaciones').addEventListener('click', () => showSection(notificationsDetails));
        document.getElementById('btn-noticias').addEventListener('click', () => showSection(newsDetails));
        document.getElementById('btn-material').addEventListener('click', () => showSection(materialDetails));
        document.getElementById('btn-foro').addEventListener('click', () => showSection(forumDetails));
        document.getElementById('btn-anotaciones').addEventListener('click', () => showSection(annotationsDetails)); // New event listener for Annotations

        // Event Listener para "Cerrar" en Asistencia
        btnCloseAttendance.addEventListener('click', () => {
            showSection(mainButtons);
            dailyDetails.style.display = 'none'; // Ocultar detalle diario al cerrar
        });

        // Event Listeners para los botones "Ver detallado" de asistencia
        document.querySelectorAll('.view-detail-btn').forEach(button => {
            button.addEventListener('click', (event) => {
                const month = event.target.dataset.month;
                detailMonthSpan.textContent = month.charAt(0).toUpperCase() + month.slice(1); // Capitalizar la primera letra
                dailyList.innerHTML = ''; // Limpiar la lista antes de añadir nuevos elementos
                dailyAttendanceData[month].forEach(item => {
                    const li = document.createElement('li');
                    li.textContent = item;
                    dailyList.appendChild(li);
                });
                monthlyHistory.style.display = 'none';
                dailyDetails.style.display = 'block';
                btnJustifyAttendance.style.display = 'block'; // Asegurarse de que el botón de justificar esté visible
            });
        });

        // Event Listener para "Cerrar detalle" en Asistencia diaria
        btnCloseDailyDetails.addEventListener('click', () => {
            dailyDetails.style.display = 'none';
            monthlyHistory.style.display = 'block';
            btnJustifyAttendance.style.display = 'none'; // Ocultar el botón de justificar
        });

        // Event Listener para "JUSTIFICAR ASISTENCIA"
        btnJustifyAttendance.addEventListener('click', () => {
            console.log("Funcionalidad de justificar asistencia. Pendiente de implementar.");
            alert("Se ha enviado una solicitud para justificar la asistencia. Pronto recibirás una respuesta.");
        });

        // Event Listener para "Cerrar" en Calificaciones
        btnCloseGrades.addEventListener('click', () => showSection(mainButtons));

        // Event Listener para "Cerrar" en Notificaciones
        btnCloseNotifications.addEventListener('click', () => {
            showSection(mainButtons);
            // Asegurarse de que al cerrar la sección de notificaciones, se muestre la sección de mensajes recientes y se oculte la de notificaciones diarias
            recentNotifications.style.display = 'block';
            dailyNotificationsDetails.style.display = 'none';
        });

        // Event Listener para "Ver todos los mensajes enviados por días"
        btnViewAllNotifications.addEventListener('click', () => {
            recentNotifications.style.display = 'none';
            dailyNotificationsDetails.style.display = 'block';
            dailyNotificationsList.innerHTML = ''; // Clear previous content

            // Populate daily notifications
            for (const date in dailyNotificationsData) {
                const dayDiv = document.createElement('div');
                dayDiv.classList.add('daily-notifications-day');

                const dateHeading = document.createElement('h4');
                dateHeading.textContent = `Fecha: ${date}`;
                dayDiv.appendChild(dateHeading);

                const ul = document.createElement('ul');
                dailyNotificationsData[date].forEach(notification => {
                    const li = document.createElement('li');
                    li.textContent = notification;
                    ul.appendChild(li);
                });
                dayDiv.appendChild(ul);
                dailyNotificationsList.appendChild(dayDiv);
            }
        });

        // Event Listener para "Cerrar detalle diario" en Notificaciones diarias
        btnCloseDailyNotifications.addEventListener('click', () => {
            dailyNotificationsDetails.style.display = 'none';
            recentNotifications.style.display = 'block';
        });

        // Establecer la fecha y hora de la reunión de apoderados (ejemplo: 26 de octubre de 2024, 18:00)
        // Puedes ajustar esta fecha y hora como necesites.
        const reunionDate = new Date('2024-10-24T18:00:00');
        const options = { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' };
        reunionDatetimeSpan.textContent = `- ${reunionDate.toLocaleDateString('es-ES', options)}`;

        // Event Listener para "Cerrar" en Noticias
        btnCloseNews.addEventListener('click', () => showSection(mainButtons));

        // Event Listener para "Cerrar" en Material de Apoyo
        btnCloseMaterial.addEventListener('click', () => {
            showSection(mainButtons);
            // Asegurarse de que al cerrar la sección de material, se muestre la lista de materias y se oculten las unidades y material de unidad
            subjectList.style.display = 'block';
            subjectUnits.style.display = 'none';
            unitMaterial.style.display = 'none';
        });

        // Event Listeners para las materias en Material de Apoyo
        document.querySelectorAll('.material-link').forEach(button => {
            button.addEventListener('click', (event) => {
                const subjectKey = event.target.dataset.subject;
                const subject = materialData[subjectKey];
                currentSubjectSpan.textContent = subject.name;
                unitsList.innerHTML = ''; // Limpiar previous content

                // Populate units for the selected subject
                for (const unitKey in subject.units) {
                    const unit = subject.units[unitKey];
                    const li = document.createElement('li');
                    li.classList.add('material-link');
                    li.dataset.subject = subjectKey; // Keep subject key for back button context if needed
                    li.dataset.unit = unitKey;
                    li.textContent = unit.name;
                    unitsList.appendChild(li);
                }

                subjectList.style.display = 'none';
                subjectUnits.style.display = 'block';
            });
        });

        // Event Listener para volver a Materias desde Unidades
        btnBackToSubjects.addEventListener('click', () => {
            subjectUnits.style.display = 'none';
            subjectList.style.display = 'block';
        });

        // Event Listeners para las unidades (para mostrar su material)
        unitsList.addEventListener('click', (event) => {
            if (event.target.classList.contains('material-link')) {
                const subjectKey = event.target.dataset.subject;
                const unitKey = event.target.dataset.unit;
                const unit = materialData[subjectKey].units[unitKey];

                currentUnitSpan.textContent = unit.name;
                materialContent.innerHTML = ''; // Clear previous content

                // Populate material for the selected unit
                unit.material.forEach(item => {
                    const p = document.createElement('p');
                    p.classList.add('mb-3', 'p-4', 'bg-gray-50', 'rounded-lg', 'shadow-sm', 'text-gray-700', 'font-medium');
                    p.textContent = item;
                    materialContent.appendChild(p);
                });

                subjectUnits.style.display = 'none';
                unitMaterial.style.display = 'block';
            }
        });

        // Event Listener para volver a Unidades desde el Material
        btnBackToUnits.addEventListener('click', () => {
            unitMaterial.style.display = 'none';
            subjectUnits.style.display = 'block';
        });

        // --- Gemini API Integration Logic ---

        // Function to open the summary modal
        function openSummaryModal() {
            summaryModal.style.display = 'flex';
            summaryText.classList.add('hidden'); // Hide text initially
            summaryError.classList.add('hidden'); // Hide error initially
            summaryLoader.classList.remove('hidden'); // Show loader
            summaryText.textContent = ''; // Clear previous summary
        }

        // Function to close the summary modal
        closeSummaryModalBtn.addEventListener('click', () => {
            summaryModal.style.display = 'none';
        });

        // Event listener for the "Generate Summary" button
        btnGenerateSummary.addEventListener('click', async () => {
            openSummaryModal(); // Open modal and show loader

            const currentUnitName = currentUnitSpan.textContent;
            const prompt = `Por favor, genera un resumen conciso y educativo sobre la unidad "${currentUnitName}". Enfócate en los conceptos clave y la información esencial. El resumen debe ser de aproximadamente 100-150 palabras.`;

            let chatHistory = [];
            chatHistory.push({ role: "user", parts: [{ text: prompt }] });
            const payload = { contents: chatHistory };
            const apiKey = ""; // If you want to use models other than gemini-2.0-flash or imagen-3.0-generate-002, provide an API key here. Otherwise, leave this as-is.
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`Error ${response.status}: ${errorData.error.message || 'Unknown error'}`);
                }

                const result = await response.json();
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    summaryText.textContent = text;
                    summaryText.classList.remove('hidden');
                } else {
                    summaryError.textContent = 'La IA no pudo generar un resumen. Intenta con un nombre de unidad diferente.';
                    summaryError.classList.remove('hidden');
                }
            } catch (error) {
                console.error('Error al llamar a la API de Gemini:', error);
                summaryError.textContent = `Error: ${error.message}. Por favor, intenta de nuevo.`;
                summaryError.classList.remove('hidden');
            } finally {
                summaryLoader.classList.add('hidden'); // Hide loader regardless of success or failure
            }
        });

        // --- Forum Logic ---
        btnCloseForum.addEventListener('click', () => showSection(mainButtons));

        btnSendForumMessage.addEventListener('click', () => {
            const messageText = forumMessageInput.value.trim();
            if (messageText) {
                const messageBubble = document.createElement('div');
                messageBubble.classList.add('message-bubble', 'sent'); // Add 'sent' class for styling
                messageBubble.innerHTML = `<span class="sender">Tú:</span> ${messageText}`;
                messagesDisplay.appendChild(messageBubble);

                // Scroll to the bottom of the messages display
                messagesDisplay.scrollTop = messagesDisplay.scrollHeight;

                forumMessageInput.value = ''; // Clear the input field

                // Simulate a teacher/classmate response after a short delay
                setTimeout(() => {
                    const responseBubble = document.createElement('div');
                    responseBubble.classList.add('message-bubble'); // Default style for received messages
                    const responses = [
                        "¡Buena pregunta! Lo discutiremos en la próxima clase.",
                        "Estoy de acuerdo, es un punto interesante.",
                        "¿Alguien más tiene alguna opinión sobre esto?",
                        "Gracias por tu aporte, [tu nombre].", // Placeholder for user name
                        "Profesor: Excelente observación. ¿Podrías elaborar un poco más?"
                    ];
                    const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                    responseBubble.innerHTML = `<span class="sender">${randomResponse.startsWith('Profesor:') ? 'Profesor:' : 'Compañero:'}</span> ${randomResponse.replace('Profesor:', '').trim()}`;
                    messagesDisplay.appendChild(responseBubble);
                    messagesDisplay.scrollTop = messagesDisplay.scrollHeight;
                }, 1500); // Respond after 1.5 seconds
            }
        });

        // Allow sending message with Enter key (but not Shift+Enter for new line)
        forumMessageInput.addEventListener('keypress', (event) => {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault(); // Prevent new line
                btnSendForumMessage.click(); // Trigger send button click
            }
        });

        // --- Annotations Logic ---
        btnCloseAnnotations.addEventListener('click', () => showSection(mainButtons));

    </script>
</body>
</html>
